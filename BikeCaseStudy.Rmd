---
title: "Bike Case Study"
author: "LKGibb"
date: "2022-09-29"
output:
  word_document: default
  html_document: default
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# SCENARIO
You are a junior data analyst working in the marketing analyst team at Cyclistic, a bike-share company in Chicago. The director
of marketing believes the companyâ€™s future success depends on maximizing the number of annual memberships. Therefore,
your team wants to understand how casual riders and annual members use Cyclistic bikes differently. From these insights,
your team will design a new marketing strategy to convert casual riders into annual members. But first, Cyclistic executives
must approve your recommendations, so they must be backed up with compelling data insights and professional data
visualizations. You have been tasked with answering the following question:

### **How do annual members and casual riders use Cyclistic bikes differently?**

# Preparation
The data was downloaded from [here](https://divvy-tripdata.s3.amazonaws.com/index.html), under this [licensing](https://ride.divvybikes.com/data-license-agreement).It is stored in an AWS server, where the files are organized by individual months, as well as quarters. The data is generated by the company, ensuring originality and reliability. It is current and comprehensive.
I began by downloading the twelve (12) most recent months of data, storing them locally for my use.

# Process
I initially loaded the data in Excel,using UNIQUE and VLOOKUP to create a master list of station names and id's to try to fill in some blanks in the data . However, when trying to merge the files into one, the resulting workbook was far too large to work with and generated errors that crippled the functionality of Excel, so I tried R.


### Begin by loading and installing the necessary packages
```{r Packages, echo=TRUE, message=FALSE, warning=FALSE, results='hide'}
install.packages("dplyr",repos = "http://cran.us.r-project.org")

install.packages("tidyverse",repos = "http://cran.us.r-project.org")

install.packages("lubridate",repos = "http://cran.us.r-project.org")

install.packages("readr",repos = "http://cran.us.r-project.org")

install.packages("shiny",repos = "http://cran.us.r-project.org")

library(dplyr)

library(tidyverse)

library(lubridate)

library(readr)

library(shiny)
```
### Load the CSV files
```{r Load CSVs, echo=TRUE, results='hide'}
tripdata202109 <- read_csv("~/CaseStudy1/2021/202109-divvy-tripdata.csv")

tripdata202110 <- read_csv("~/CaseStudy1/2021/202110-divvy-tripdata.csv")

tripdata202111 <- read_csv("~/CaseStudy1/2021/202111-divvy-tripdata.csv")

tripdata202112 <- read_csv("~/CaseStudy1/2021/202112-divvy-tripdata.csv")

tripdata202101 <- read_csv("~/CaseStudy1/2021/202101-divvy-tripdata.csv")

tripdata202102 <- read_csv("~/CaseStudy1/2021/202102-divvy-tripdata.csv")

tripdata202103 <- read_csv("~/CaseStudy1/2021/202103-divvy-tripdata.csv")

tripdata202104 <- read_csv("~/CaseStudy1/2021/202104-divvy-tripdata.csv")

tripdata202105 <- read_csv("~/CaseStudy1/2021/202105-divvy-tripdata.csv")

tripdata202106 <- read_csv("~/CaseStudy1/2021/202106-divvy-tripdata.csv")

tripdata202107 <- read_csv("~/CaseStudy1/2021/202107-divvy-tripdata.csv")

tripdata202108 <- read_csv("~/CaseStudy1/2021/202108-divvy-tripdata.csv")

```
### Consolidate the data
Before merging the data into a single file, I must make sure the files each have the same columns. 
```{r ColNames}
colnames(tripdata202109)
colnames(tripdata202110)
colnames(tripdata202111)
colnames(tripdata202112)
colnames(tripdata202101)
colnames(tripdata202102)
colnames(tripdata202103)
colnames(tripdata202104)
colnames(tripdata202105)
colnames(tripdata202106)
colnames(tripdata202107)
colnames(tripdata202108)
```
![image](https://user-images.githubusercontent.com/112521313/195654193-c2f16825-7e09-4401-a1b6-de96ad790fd9.png)

All the columns are the same, so we can proceed merging all the data into a single CSV file.
```{r Write CSV, echo=T, results='hide'}
setwd("~/CaseStudy1/2021")
df <- list.files(path="C:/Users/PC/Documents/CaseStudy1/2021", full.names = TRUE) %>% 
  lapply(read_csv) %>% 
  bind_rows 

write.csv(df,'alltripdata01.csv', row.names=FALSE)
```
Let's check and make sure all the columns in the new CSV file are correct.
```{r}
atd <- read_csv("~/CaseStudy1/2021/alltripdata01.csv")
View(atd)
```
### Add new column with the day of the week the trip began
```{r Add Day of Week}
atd <- dplyr::mutate(atd, day_of_week=weekdays(started_at), .before = "started_at")
head(atd)
```

### Add new column with total time per ride

```{r Total Ride Time}
atd <- mutate(atd, ride_length=difftime(ended_at,started_at,units="mins"), .after = "day_of_week")
```
Let's make sure the new column values are accurate
```{r Ride Length <0}
filter(atd, ride_length <0)
```
We don't want to include values that are less than 0 seconds, so we will drop these and check to make sure they're gone.
```{r Drop negative ride time}
atd <- filter(atd$ride_length >0)
check<- atd%>%
  filter(atd$ride_length <0)
View(check)
```
Let's separate the month and time out as separate columns for started_at and ended_at. This will give us some more options to drill down and find more trends.

### Add new columns with starting month, ending month, time started, and time ended

```{r Add month and time columns}
atd <- mutate(atd, month_started=month(started_at), .after = "started_at")
atd <- mutate(atd, month_ended=month(ended_at), .after = "ended_at")
atd <- separate(atd,started_at, c("date_started","time_started"), sep = " ", remove = FALSE)
atd <- separate(atd,ended_at, c("date_ended","time_ended"), sep = " ", remove = FALSE)
head(atd)
```

# Analyze
Now that we have a clean data set, let's start the analysis!
Since the main goal is to find out the main difference between members and casual riders, let's begin with the total numbers of each.
### Total trips by customer type
```{r Total  trips}
casualmembertotal<- atd %>% count(member_casual,month_started, sort = TRUE)
cmtotal<- atd %>% count(member_casual, sort = TRUE)
head(cmtotal)
```
There are more than 500,000 more members than casual riders, so people are already seeing the value in membership! Let's see what else we can find out in this data!

### Average ride time
Now we'll determine overall ride time, as well as breaking it down by customer type, month started, and day started.

```{r Average ride times}
rideavg<- mean(atd$ride_length)

cmavgridetime<- atd %>%
   group_by(member_casual, month_started) %>% 
   summarise_at(vars(ride_length), list(ride_time = mean))

View(rideavg)
View(cmavgridetime)
```
Let's break that down into separate tibbles, one for casual users and one for members.
```{r Ride times}
casualridetime<- filter(cmavgridetime, member_casual == "casual")

memberridetime<- filter(cmavgridetime, member_casual == "member")


View(casualridetime)
View(memberridetime)
```
Let's find the min and max average ride time for each month, as well as the difference between them.
```{r Min/Max Difference for Member}
minmember<- min(memberridetime$ride_time)
maxmember<- max(memberridetime$ride_time)
difmember<- maxmember - minmember
print(minmember)
print(maxmember)
print(difmember)
```
```{r Min/Max Difference for Casual}
mincasual<- min(casualridetime$ride_time)
maxcasual<- max(casualridetime$ride_time)
difcasual<- maxcasual - mincasual
print(mincasual)
print(maxcasual)
print(difcasual)
```
```{r Casual/Member Ride Time Difference}
minmembercasual<- mincasual - minmember
maxmembercasual<- maxcasual - maxmember
difmembercasual<- difcasual - difmember
print(minmembercasual)
print(maxmembercasual)
print(difmembercasual)

```

# Visualizations

Let's make some of this analysis easier to spot and understand with visualizations!

```{r Average Riders by Month}
p<- ggplot(data = casualmembertotal, aes(fill=member_casual, y=n, x=month_started)) + 
    geom_bar(position="dodge", stat="identity")
p + ggtitle("Average Riders by Month in 2021") + scale_x_continuous(name="Month", breaks = seq(1,12,1)) + scale_y_continuous(name="Total Rides", labels = scales::comma) + labs(fill = "User Type")
```


```{r Total Rides}
p2<- ggplot (data = cmtotal) + geom_col(mapping=aes(x=member_casual, y=n, fill=member_casual))
p2 + ggtitle("Total Rides in 2021") + 
  xlab("") + scale_y_continuous(name = "", labels = scales::comma)
```

```{r Average Ride Time by Month}
p3<- ggplot(data = cmavgridetime, aes(fill=member_casual, y=ride_time, x=month_started)) + 
    geom_bar(position="dodge", stat="identity")
p3 + ggtitle("Average Ride Time by Month in 2021") + scale_x_continuous(name="Month", breaks = seq(1,12,1)) + scale_y_continuous(name="Ride Time (in minutes)", labels = scales::comma) + labs(fill = "User Type")
```



### Make an updated CSV file with all the changes we've made so far
We'll make one file of our atd dataframe, as well as ones for some of the other tibbles we've created during analysis. These can be used for further data analysis in another programming language, like SQL, as well as visualization tools, like Power BI or Tableau
```{r}
write.csv(atd, 'atd01.csv', row.names = FALSE)
write.csv(casualmembertotal, 'casualmembertotal.csv', row.names = FALSE)
write.csv(casualridetime, 'cridetime.csv', row.names = FALSE)
write.csv(cmavgridetime, 'cmavgridetime.csv', row.names = FALSE)
write.csv(cmtotal, 'cmtotal.csv', row.names = FALSE)
write.csv(memberridetime, 'memberridetime.csv', row.names = FALSE)
write.csv(atd, 'atd01.csv', row.names = FALSE)
```



